<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Introduction to Data Analysis with R &amp; Reproducible Data Science</title>
  <meta name="description" content="Introduction to Data Analysis with R &amp; Reproducible Data Science">
  <meta name="generator" content="bookdown 0.4 and GitBook 2.6.7">

  <meta property="og:title" content="Introduction to Data Analysis with R &amp; Reproducible Data Science" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="IRSAAtUMn/RWorkshop17/docs" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Introduction to Data Analysis with R &amp; Reproducible Data Science" />
  
  
  

<meta name="author" content="Institute for Research in Statistics and its Applications at the University of Minnesota">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="simple-statistics-in-r.html">
<link rel="next" href="quantile-regression-in-r.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Home</a></li>
<li class="chapter" data-level="1" data-path="introduction-to-r-rstudio.html"><a href="introduction-to-r-rstudio.html"><i class="fa fa-check"></i><b>1</b> Introduction to R &amp; RStudio</a></li>
<li class="chapter" data-level="2" data-path="data-visualization.html"><a href="data-visualization.html"><i class="fa fa-check"></i><b>2</b> Data Visualization</a></li>
<li class="chapter" data-level="3" data-path="simple-statistics-in-r.html"><a href="simple-statistics-in-r.html"><i class="fa fa-check"></i><b>3</b> Simple Statistics in R</a></li>
<li class="chapter" data-level="4" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html"><i class="fa fa-check"></i><b>4</b> Linear Regression in R</a><ul>
<li class="chapter" data-level="4.1" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#chapter-outline-and-goals"><i class="fa fa-check"></i><b>4.1</b> Chapter Outline and Goals</a></li>
<li class="chapter" data-level="4.2" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#minnesota-beer-data-reminder"><i class="fa fa-check"></i><b>4.2</b> Minnesota Beer Data (Reminder)</a><ul>
<li class="chapter" data-level="4.2.1" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#overview"><i class="fa fa-check"></i><b>4.2.1</b> Overview</a></li>
<li class="chapter" data-level="4.2.2" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#load-and-look-at-the-data"><i class="fa fa-check"></i><b>4.2.2</b> Load and Look at the Data</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#simple-linear-regression"><i class="fa fa-check"></i><b>4.3</b> Simple Linear Regression</a><ul>
<li class="chapter" data-level="4.3.1" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#fit-the-model"><i class="fa fa-check"></i><b>4.3.1</b> Fit the Model</a></li>
<li class="chapter" data-level="4.3.2" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#inference-information"><i class="fa fa-check"></i><b>4.3.2</b> Inference Information</a></li>
<li class="chapter" data-level="4.3.3" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#plot-the-regression-line"><i class="fa fa-check"></i><b>4.3.3</b> Plot the Regression Line</a></li>
<li class="chapter" data-level="4.3.4" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#diagnostic-and-influence-plots"><i class="fa fa-check"></i><b>4.3.4</b> Diagnostic and Influence Plots</a></li>
<li class="chapter" data-level="4.3.5" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#prediction-for-new-data"><i class="fa fa-check"></i><b>4.3.5</b> Prediction for New Data</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#multiple-linear-regression"><i class="fa fa-check"></i><b>4.4</b> Multiple Linear Regression</a><ul>
<li class="chapter" data-level="4.4.1" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#overview-1"><i class="fa fa-check"></i><b>4.4.1</b> Overview</a></li>
<li class="chapter" data-level="4.4.2" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#additive-effects"><i class="fa fa-check"></i><b>4.4.2</b> Additive Effects</a></li>
<li class="chapter" data-level="4.4.3" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#interaction-effects"><i class="fa fa-check"></i><b>4.4.3</b> Interaction Effects</a></li>
<li class="chapter" data-level="4.4.4" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#comparing-fit-models"><i class="fa fa-check"></i><b>4.4.4</b> Comparing Fit Models</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="linear-regression-in-r.html"><a href="linear-regression-in-r.html#exercises"><i class="fa fa-check"></i><b>4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="quantile-regression-in-r.html"><a href="quantile-regression-in-r.html"><i class="fa fa-check"></i><b>5</b> Quantile Regression in R</a></li>
<li class="chapter" data-level="6" data-path="an-r-markdown-demo.html"><a href="an-r-markdown-demo.html"><i class="fa fa-check"></i><b>6</b> An R Markdown Demo</a></li>
<li class="chapter" data-level="7" data-path="git-version-control.html"><a href="git-version-control.html"><i class="fa fa-check"></i><b>7</b> Git (Version Control)</a></li>
<li class="chapter" data-level="8" data-path="using-r-reproducibly.html"><a href="using-r-reproducibly.html"><i class="fa fa-check"></i><b>8</b> Using R Reproducibly</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to Data Analysis with R &amp; Reproducible Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="linear-regression-in-r" class="section level1">
<h1><span class="header-section-number"> 4</span> Linear Regression in R</h1>
<p><em>Author: Nathaniel E. Helwig</em></p>
<div id="chapter-outline-and-goals" class="section level2">
<h2><span class="header-section-number">4.1</span> Chapter Outline and Goals</h2>
<p>In this chapter, we will cover how to…</p>
<ul>
<li>Fit simple and multiple linear regression models</li>
<li>Test the significance of regression coefficients</li>
<li>Plot and interpret the regression results</li>
<li>Make predictions from fit regression models</li>
</ul>
<p>R’s <strong>lm</strong> (linear model) function will be the primary tool used in the chapter.</p>
</div>
<div id="minnesota-beer-data-reminder" class="section level2">
<h2><span class="header-section-number">4.2</span> Minnesota Beer Data (Reminder)</h2>
<div id="overview" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Overview</h3>
<p>The Minnesota beer data has 44 beers measured on 7 variables:</p>
<ol style="list-style-type: decimal">
<li><em>Brewery</em>: Name of the brewery (<strong>factor</strong> with 8 levels)</li>
<li><em>Beer</em>: Name of the beer (<strong>factor</strong> with 44 levels)</li>
<li><em>Description</em>: Description of the beer (<strong>factor</strong> with 37 levels)</li>
<li><em>Style</em>: Style of the beer (<strong>factor</strong> with 3 levels)</li>
<li><em>ABV</em>: Alcohol by volume (<strong>numeric</strong>)</li>
<li><em>IBU</em>: International bitterness units (<strong>integer</strong>)</li>
<li><em>Rating</em>: Beer Advocate rating (<strong>integer</strong>)</li>
</ol>
<p>Data obtained by NEH from <a href="http://beeradvocate.com">Beer Advocate</a> and the websites of the eight breweries.</p>
</div>
<div id="load-and-look-at-the-data" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Load and Look at the Data</h3>
<p>Use the <strong>read.csv</strong> function to load the <em>beer</em> data into R</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">beer &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;http://users.stat.umn.edu/~helwig/notes/MNbeer.csv&quot;</span>)</code></pre></div>
<p>The <strong>head</strong> function returns the first six lines of a data frame</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(beer)</code></pre></div>
<pre><code>##       Brewery         Beer              Description Style ABV IBU Rating
## 1     Bauhaus  Wonderstuff     New Bohemian Pilsner Lager 5.4  48     88
## 2     Bauhaus    Stargazer German Style Schwarzbier Lager 5.0  28     87
## 3     Bauhaus  Wagon Party    West Cost Style Lager Lager 5.4  55     86
## 4     Bauhaus    Sky-Five!        Midwest Coast IPA   IPA 6.7  70     86
## 5 Bent Paddle         Kanu         Session Pale Ale   Ale 4.8  48     85
## 6 Bent Paddle Venture Pils            Pilsner Lager Lager 5.0  38     87</code></pre>
</div>
</div>
<div id="simple-linear-regression" class="section level2">
<h2><span class="header-section-number">4.3</span> Simple Linear Regression</h2>
<div id="fit-the-model" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Fit the Model</h3>
<p>Consider a simple linear regression model of the form <span class="math display">\[
y_i = \beta_0 + \beta_1 x_i + \epsilon_i
\]</span> where <span class="math inline">\(y_i\)</span> is the Rating of the <em>i</em>-th beer (response), <span class="math inline">\(x_i\)</span> is the ABV of the <em>i</em>-th beer (predictor), <span class="math inline">\(\beta_0\)</span> is the unknown regression intercept, <span class="math inline">\(\beta_1\)</span> is the unknown regression slope, and <span class="math inline">\(\epsilon_i \sim \mathrm{N}(0, \sigma^2)\)</span> is a latent Gaussian error term. To fit the model, we can use the <strong>lm</strong> function</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod &lt;-<span class="st"> </span><span class="kw">lm</span>(Rating ~<span class="st"> </span>ABV, <span class="dt">data =</span> beer)</code></pre></div>
<p>The first input is the regression formula (Response ~ Predictor), and the second input is the data frame containing the variables in the regression formula. Note that <em>mod</em> is an object of class <em>lm</em>, which is a list containing information about the fit model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(mod)</code></pre></div>
<pre><code>## [1] &quot;lm&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(mod)</code></pre></div>
<pre><code>##  [1] &quot;coefficients&quot;  &quot;residuals&quot;     &quot;effects&quot;       &quot;rank&quot;         
##  [5] &quot;fitted.values&quot; &quot;assign&quot;        &quot;qr&quot;            &quot;df.residual&quot;  
##  [9] &quot;xlevels&quot;       &quot;call&quot;          &quot;terms&quot;         &quot;model&quot;</code></pre>
<p>For example, the <em>$coefficients</em> element contains the estimated regression coefficients</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod$coefficients</code></pre></div>
<pre><code>## (Intercept)         ABV 
##   74.034788    2.259646</code></pre>
<p>which reveal that the expected Rating increases by about 2.26 points for every 1 unit (i.e., 1%) increaese in ABV.</p>
</div>
<div id="inference-information" class="section level3">
<h3><span class="header-section-number">4.3.2</span> Inference Information</h3>
<p>To obtain a more detailed summary of the fit model, use the <strong>summary</strong> function</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">modsum &lt;-<span class="st"> </span><span class="kw">summary</span>(mod)
<span class="kw">names</span>(modsum)</code></pre></div>
<pre><code>##  [1] &quot;call&quot;          &quot;terms&quot;         &quot;residuals&quot;     &quot;coefficients&quot; 
##  [5] &quot;aliased&quot;       &quot;sigma&quot;         &quot;df&quot;            &quot;r.squared&quot;    
##  [9] &quot;adj.r.squared&quot; &quot;fstatistic&quot;    &quot;cov.unscaled&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">modsum</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Rating ~ ABV, data = beer)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -7.4965 -2.1563  0.3593  1.6670  7.0179 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  74.0348     3.5933  20.604  &lt; 2e-16 ***
## ABV           2.2596     0.6117   3.694 0.000632 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 3.28 on 42 degrees of freedom
## Multiple R-squared:  0.2452, Adjusted R-squared:  0.2272 
## F-statistic: 13.65 on 1 and 42 DF,  p-value: 0.000632</code></pre>
<p>Note that summarizing an <em>lm</em> object returns the estimated error standard deviation <em>sigma</em> (<span class="math inline">\(\hat{\sigma} = 3.28\)</span>), the coefficient of determination <em>r.squared</em> (<span class="math inline">\(R^2 = 0.2452\)</span>), and a <em>coefficient</em> inference table for testing <span class="math inline">\(H_0: \beta_j = 0\)</span> versus <span class="math inline">\(H_1: \beta_j \neq 0\)</span>. The observed <em>t</em> statistic for testing the slope parameter is <span class="math inline">\(t = 3.69\)</span> with 42 degrees of freedom, resulting in a p-value less than 0.001—we reject <span class="math inline">\(H_0\)</span> using any standard <span class="math inline">\(\alpha\)</span> level.</p>
<p>Use the <strong>confint</strong> function to obtain confidence intervals for regression coefficients</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">confint</span>(mod, <span class="st">&quot;ABV&quot;</span>)</code></pre></div>
<pre><code>##        2.5 %   97.5 %
## ABV 1.025152 3.494139</code></pre>
<p>The 95% confidence interval for <span class="math inline">\(\beta_1\)</span> reveals that we expect the average Rating to increase by 1.03 to 3.49 points for each additional 1% ABV.</p>
</div>
<div id="plot-the-regression-line" class="section level3">
<h3><span class="header-section-number">4.3.3</span> Plot the Regression Line</h3>
<p>The <strong>abline</strong> function makes it easy to include the least-squares regression line on a scatterplot</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(beer$ABV, beer$Rating, <span class="dt">xlab =</span> <span class="st">&quot;Alcohol By Volume&quot;</span>, 
     <span class="dt">ylab =</span> <span class="st">&quot;Beer Advocate Rating&quot;</span>, <span class="dt">main =</span> <span class="st">&quot;Alcohol by Rating&quot;</span>)
<span class="kw">abline</span>(mod)</code></pre></div>
<p><img src="RWorkshop17_files/figure-html/unnamed-chunk-8-1.png" width="480" style="display: block; margin: auto;" /></p>
</div>
<div id="diagnostic-and-influence-plots" class="section level3">
<h3><span class="header-section-number">4.3.4</span> Diagnostic and Influence Plots</h3>
<p>R makes it really easy to create simple diagnostic and influence plots for a fit regression model:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(mod)</code></pre></div>
<p><img src="RWorkshop17_files/figure-html/unnamed-chunk-9-1.png" width="480" style="display: block; margin: auto;" /><img src="RWorkshop17_files/figure-html/unnamed-chunk-9-2.png" width="480" style="display: block; margin: auto;" /><img src="RWorkshop17_files/figure-html/unnamed-chunk-9-3.png" width="480" style="display: block; margin: auto;" /><img src="RWorkshop17_files/figure-html/unnamed-chunk-9-4.png" width="480" style="display: block; margin: auto;" /></p>
</div>
<div id="prediction-for-new-data" class="section level3">
<h3><span class="header-section-number">4.3.5</span> Prediction for New Data</h3>
<p>We often want to use a fit regression model to create predictions for new data. In R, this involves first creating the data frame of new predictor scores</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">newdata &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">ABV =</span> <span class="kw">seq</span>(<span class="fl">4.2</span>, <span class="fl">7.5</span>, <span class="dt">by =</span> <span class="fl">0.1</span>))</code></pre></div>
<p>which we input to the <strong>predict</strong> function along with the fit model</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">newfit &lt;-<span class="st"> </span><span class="kw">predict</span>(mod, newdata)
newfit</code></pre></div>
<pre><code>##        1        2        3        4        5        6        7        8 
## 83.52530 83.75127 83.97723 84.20319 84.42916 84.65512 84.88109 85.10705 
##        9       10       11       12       13       14       15       16 
## 85.33302 85.55898 85.78495 86.01091 86.23688 86.46284 86.68880 86.91477 
##       17       18       19       20       21       22       23       24 
## 87.14073 87.36670 87.59266 87.81863 88.04459 88.27056 88.49652 88.72249 
##       25       26       27       28       29       30       31       32 
## 88.94845 89.17441 89.40038 89.62634 89.85231 90.07827 90.30424 90.53020 
##       33       34 
## 90.75617 90.98213</code></pre>
<p>By default, the <strong>predict</strong> function returns a vector of predictions <span class="math inline">\(\hat{y}_{i(\mbox{new})} = \hat{\beta}_0 + \hat{\beta}_1 x_{i(\mbox{new})}\)</span>. To obtain the corresponding standard errors of the predictions, we can use the <em>se.fit</em> input</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">newfitse &lt;-<span class="st"> </span><span class="kw">predict</span>(mod, newdata, <span class="dt">se.fit =</span> <span class="ot">TRUE</span>)
newfitse</code></pre></div>
<pre><code>## $fit
##        1        2        3        4        5        6        7        8 
## 83.52530 83.75127 83.97723 84.20319 84.42916 84.65512 84.88109 85.10705 
##        9       10       11       12       13       14       15       16 
## 85.33302 85.55898 85.78495 86.01091 86.23688 86.46284 86.68880 86.91477 
##       17       18       19       20       21       22       23       24 
## 87.14073 87.36670 87.59266 87.81863 88.04459 88.27056 88.49652 88.72249 
##       25       26       27       28       29       30       31       32 
## 88.94845 89.17441 89.40038 89.62634 89.85231 90.07827 90.30424 90.53020 
##       33       34 
## 90.75617 90.98213 
## 
## $se.fit
##         1         2         3         4         5         6         7 
## 1.1064827 1.0521132 0.9985311 0.9458702 0.8942934 0.8439992 0.7952311 
##         8         9        10        11        12        13        14 
## 0.7482877 0.7035342 0.6614152 0.6224659 0.5873171 0.5566893 0.5313647 
##        15        16        17        18        19        20        21 
## 0.5121308 0.4996912 0.4945590 0.4969606 0.5067890 0.5236260 0.5468247 
##        22        23        24        25        26        27        28 
## 0.5756164 0.6092087 0.6468540 0.6878872 0.7317387 0.7779320 0.8260744 
##        29        30        31        32        33        34 
## 0.8758444 0.9269800 0.9792672 1.0325312 1.0866283 1.1414400 
## 
## $df
## [1] 42
## 
## $residual.scale
## [1] 3.279704</code></pre>
<p>The <em>interval</em> input can be used to create confidence and prediction intervals</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">newfitCI &lt;-<span class="st"> </span><span class="kw">predict</span>(mod, newdata, <span class="dt">interval =</span> <span class="st">&quot;confidence&quot;</span>)
newfitPI &lt;-<span class="st"> </span><span class="kw">predict</span>(mod, newdata, <span class="dt">interval =</span> <span class="st">&quot;prediction&quot;</span>)
<span class="kw">head</span>(newfitCI)</code></pre></div>
<pre><code>##        fit      lwr      upr
## 1 83.52530 81.29233 85.75827
## 2 83.75127 81.62801 85.87452
## 3 83.97723 81.96211 85.99235
## 4 84.20319 82.29435 86.11204
## 5 84.42916 82.62440 86.23392
## 6 84.65512 82.95186 86.35838</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(newfitPI)</code></pre></div>
<pre><code>##        fit      lwr      upr
## 1 83.52530 76.54007 90.51053
## 2 83.75127 76.80033 90.70220
## 3 83.97723 77.05856 90.89590
## 4 84.20319 77.31472 91.09166
## 5 84.42916 77.56880 91.28951
## 6 84.65512 77.82077 91.48948</code></pre>
<p>The confidence and prediction intervals can be plotted using</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(beer$ABV, beer$Rating, <span class="dt">xlab =</span> <span class="st">&quot;Alcohol By Volume&quot;</span>, 
     <span class="dt">ylab =</span> <span class="st">&quot;Beer Advocate Rating&quot;</span>, <span class="dt">main =</span> <span class="st">&quot;Alcohol by Rating&quot;</span>,
     <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">75</span>, <span class="dv">100</span>))
<span class="kw">lines</span>(newdata$ABV, newfitCI[,<span class="dv">1</span>])
<span class="kw">lines</span>(newdata$ABV, newfitCI[,<span class="dv">2</span>], <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)
<span class="kw">lines</span>(newdata$ABV, newfitCI[,<span class="dv">3</span>], <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)
<span class="kw">lines</span>(newdata$ABV, newfitPI[,<span class="dv">2</span>], <span class="dt">lty =</span> <span class="dv">3</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)
<span class="kw">lines</span>(newdata$ABV, newfitPI[,<span class="dv">3</span>], <span class="dt">lty =</span> <span class="dv">3</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)
<span class="kw">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>:<span class="dv">3</span>, <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&quot;fit&quot;</span>, <span class="st">&quot;95% CI&quot;</span>, <span class="st">&quot;95% PI&quot;</span>),
       <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="dt">bty =</span> <span class="st">&quot;n&quot;</span>)</code></pre></div>
<p><img src="RWorkshop17_files/figure-html/unnamed-chunk-14-1.png" width="480" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="multiple-linear-regression" class="section level2">
<h2><span class="header-section-number">4.4</span> Multiple Linear Regression</h2>
<div id="overview-1" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Overview</h3>
<p>A multiple linear regression model has the form <span class="math display">\[
y_i = \beta_0 + \sum_{j=1}^p \beta_j x_{ij} + \epsilon_i
\]</span> where <span class="math inline">\(y_i\)</span> is the response for the <span class="math inline">\(i\)</span>-th observation, <span class="math inline">\(x_{ij}\)</span> is the <em>j</em>-th predictor for the <em>i</em>-th observation, <span class="math inline">\(\beta_0\)</span> is the unknown regression intercept, <span class="math inline">\(\beta_j\)</span> is the unknown regression slope for the <em>j</em>-th predictor, and <span class="math inline">\(\epsilon_i \sim \mathrm{N}(0, \sigma^2)\)</span> is a latent Gaussian error term. Note that <span class="math inline">\(\beta_j\)</span> gives the expected change in the response variable for a 1-unit change in the <em>j</em>-th predictor variable conditioned on the other predictors, i.e., holding all other predictors constant.</p>
</div>
<div id="additive-effects" class="section level3">
<h3><span class="header-section-number">4.4.2</span> Additive Effects</h3>
<p>We will start by considering a model predicting the Rating from the additive effects of ABV and Brewery</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">amod &lt;-<span class="st"> </span><span class="kw">lm</span>(Rating ~<span class="st"> </span>ABV +<span class="st"> </span>Brewery, <span class="dt">data =</span> beer)</code></pre></div>
<p>Note that this model allows each Brewery to have a unique regression intercept (Bauhaus is the baseline), but assumes that the slope between ABV and Rating is the same for each Brewery. We can summarize the model using the same approach as before:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">amodsum &lt;-<span class="st"> </span><span class="kw">summary</span>(amod)
amodsum</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Rating ~ ABV + Brewery, data = beer)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -4.702 -1.477  0.217  1.207  5.505 
## 
## Coefficients:
##                      Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)          77.82164    3.27842  23.738  &lt; 2e-16 ***
## ABV                   1.58726    0.53419   2.971  0.00533 ** 
## BreweryBent Paddle    1.01666    1.75996   0.578  0.56719    
## BreweryFulton        -2.27857    1.75923  -1.295  0.20373    
## BreweryIndeed         0.87472    1.64545   0.532  0.59836    
## BrewerySteel Toe      0.05955    1.89701   0.031  0.97513    
## BrewerySummit        -1.16837    1.64440  -0.711  0.48209    
## BrewerySurly          4.25343    1.68773   2.520  0.01644 *  
## BreweryUrban Growler -3.22777    1.76155  -1.832  0.07542 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.622 on 35 degrees of freedom
## Multiple R-squared:  0.5979, Adjusted R-squared:  0.506 
## F-statistic: 6.506 on 8 and 35 DF,  p-value: 3.502e-05</code></pre>
<p>Compared to the simple linear regression model containing only the ABV predictor, we have noticeably reduced the residual standard deviation estimate <em>sigma</em> (<span class="math inline">\(\hat{\sigma} = 2.622\)</span>) and increased the coefficient of (multiple) determination <em>r.squared</em> (<span class="math inline">\(R^2 = 0.5979\)</span>).</p>
<p>The <strong>anova</strong> and <strong>Anova</strong> functions can be used to test the significance of terms</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(car)</code></pre></div>
<pre><code>## Warning: package &#39;car&#39; was built under R version 3.4.1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anova</span>(amod)  <span class="co"># Type I (sequential) SS test</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: Rating
##           Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## ABV        1 146.77 146.774 21.3451 5.026e-05 ***
## Brewery    7 211.10  30.157  4.3857  0.001393 ** 
## Residuals 35 240.67   6.876                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Anova</span>(amod)  <span class="co"># Type II SS test</span></code></pre></div>
<pre><code>## Anova Table (Type II tests)
## 
## Response: Rating
##            Sum Sq Df F value   Pr(&gt;F)   
## ABV        60.709  1  8.8288 0.005331 **
## Brewery   211.102  7  4.3857 0.001393 **
## Residuals 240.669 35                    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Note that <strong>anova</strong> tests the effects sequentially (ABV alone, then Brewery given ABV), whereas the <strong>Anova</strong> function (in the <em>car</em> package) tests the effects conditioned on the other effect (ABV given Brewery, Brewery given ABV). Using the Type II tests from the <strong>Anova</strong> function, we see that both ABV (<span class="math inline">\(F_{1,35} = 8.83, p = 0.005\)</span>) and Brewery (<span class="math inline">\(F_{7,35} = 4.39, p = 0.001\)</span>) significantly add to the prediction of the beer’s Rating.</p>
</div>
<div id="interaction-effects" class="section level3">
<h3><span class="header-section-number">4.4.3</span> Interaction Effects</h3>
<p>Next we consider a model predicting the Rating from the interaction effects of ABV and Brewery</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">imod &lt;-<span class="st"> </span><span class="kw">lm</span>(Rating ~<span class="st"> </span>ABV *<span class="st"> </span>Brewery, <span class="dt">data =</span> beer)</code></pre></div>
<p>Note that formula notation is shorthand for <em>Rating ~ ABV + Brewery + ABV:Brewery</em>, so this model allows each Brewery to have a unique regression intercept and slope relating ABV and Rating. We can summarize the model using the same approach as before:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">imodsum &lt;-<span class="st"> </span><span class="kw">summary</span>(imod)
imodsum</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Rating ~ ABV * Brewery, data = beer)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.2905 -1.3040 -0.0471  1.4774  4.9434 
## 
## Coefficients:
##                          Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)               90.4203    12.4097   7.286 6.22e-08 ***
## ABV                       -0.6525     2.1920  -0.298    0.768    
## BreweryBent Paddle       -17.0655    17.8235  -0.957    0.347    
## BreweryFulton            -18.8852    14.6059  -1.293    0.207    
## BreweryIndeed             -8.1702    14.4123  -0.567    0.575    
## BrewerySteel Toe         -16.6529    16.6037  -1.003    0.324    
## BrewerySummit            -11.2505    15.7834  -0.713    0.482    
## BrewerySurly             -12.0484    14.6792  -0.821    0.419    
## BreweryUrban Growler      -8.6554    19.7273  -0.439    0.664    
## ABV:BreweryBent Paddle     3.2331     3.1819   1.016    0.318    
## ABV:BreweryFulton          2.9580     2.5806   1.146    0.261    
## ABV:BreweryIndeed          1.6240     2.5265   0.643    0.526    
## ABV:BrewerySteel Toe       2.8851     2.7839   1.036    0.309    
## ABV:BrewerySummit          1.7846     2.8071   0.636    0.530    
## ABV:BrewerySurly           2.8236     2.5109   1.125    0.270    
## ABV:BreweryUrban Growler   1.0034     3.4276   0.293    0.772    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.813 on 28 degrees of freedom
## Multiple R-squared:  0.6297, Adjusted R-squared:  0.4313 
## F-statistic: 3.174 on 15 and 28 DF,  p-value: 0.004029</code></pre>
<p>Compared to the additive model, we have slightly increased the residual standard deviation estimate <em>sigma</em> (<span class="math inline">\(\hat{\sigma} = 2.813\)</span>) and increased the coefficient of (multiple) determination <em>r.squared</em> (<span class="math inline">\(R^2 = 0.6297\)</span>).</p>
<p>Use the <strong>Anova</strong> function to test the signifiance of the effects</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(car)
<span class="kw">Anova</span>(imod)  <span class="co"># Type II SS test</span></code></pre></div>
<pre><code>## Anova Table (Type II tests)
## 
## Response: Rating
##              Sum Sq Df F value   Pr(&gt;F)   
## ABV          60.709  1  7.6695 0.009854 **
## Brewery     211.102  7  3.8098 0.005009 **
## ABV:Brewery  19.030  7  0.3434 0.926653   
## Residuals   221.639 28                    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The results reveal that the interaction effect is not significant (<span class="math inline">\(F_{7,28} = 0.34, p = 0.927\)</span>), but the main effects of ABV (<span class="math inline">\(F_{1,28} = 7.67, p = 0.01\)</span>) and Brewery (<span class="math inline">\(F_{7,28} = 3.81, p = 0.005\)</span>) are significant at the classic <span class="math inline">\(\alpha = 0.05\)</span> significance level.</p>
</div>
<div id="comparing-fit-models" class="section level3">
<h3><span class="header-section-number">4.4.4</span> Comparing Fit Models</h3>
<p>To compare the fit models, we can use the <strong>anova</strong> function for <em>F</em>-tests</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anova</span>(mod, amod, imod)</code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: Rating ~ ABV
## Model 2: Rating ~ ABV + Brewery
## Model 3: Rating ~ ABV * Brewery
##   Res.Df    RSS Df Sum of Sq      F   Pr(&gt;F)   
## 1     42 451.77                                
## 2     35 240.67  7    211.10 3.8098 0.005009 **
## 3     28 221.64  7     19.03 0.3434 0.926653   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>or the <strong>AIC</strong> function to extract Akaike’s information criterion</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">AIC</span>(mod, amod, imod)</code></pre></div>
<pre><code>##      df      AIC
## mod   3 233.3420
## amod 10 219.6329
## imod 17 230.0085</code></pre>
<p>In this case, the <em>F</em>-tests and AIC values suggest that the additive model should be preferred. We conclude that each Brewery has a unique baseline Rating, and increasing the ABV by 1% corresponds to an expected 1.59 point increase in the Rating.</p>
</div>
</div>
<div id="exercises" class="section level2">
<h2><span class="header-section-number">4.5</span> Exercises</h2>
<ol style="list-style-type: decimal">
<li>Load the Minnesota Beer Data into R.</li>
<li>Make a scatterplot of the IBU (x-axis) by Rating (y-axis)</li>
<li>Fit a simple linear regression model predicting Rating from IBU.</li>
<li>Is there a significant linear relationship between IBU and Rating?</li>
<li>Plot the linear relationship, along with 95% confidence and prediction intervals.</li>
<li>Fit a multiple linear regression model predicting Rating from the additive effects of IBU and Brewery.</li>
<li>Fit a multiple linear regression model predicting Rating from the additive and interaction effects of IBU and Brewery.</li>
<li>Considering the models you fit in Ex 3, 7, 8, which do you prefer and why?</li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="simple-statistics-in-r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="quantile-regression-in-r.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"download": null,
"toc": {
"collapse": "section",
"depth": 2,
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
